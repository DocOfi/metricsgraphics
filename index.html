<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Metricsgraphics by hrbrmstr</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Metricsgraphics</h1>
        <p>An htmlwidget interface to the MetricsGraphics.js D3 chart library</p>

        <p class="view"><a href="https://github.com/hrbrmstr/metricsgraphics">View the Project on GitHub <small>hrbrmstr/metricsgraphics</small></a></p>


        <ul>
          <li><a href="https://github.com/hrbrmstr/metricsgraphics/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/hrbrmstr/metricsgraphics/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/hrbrmstr/metricsgraphics">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>Mozilla released the <a href="http://metricsgraphicsjs.org/">MetricsGraphics.js library</a> back in November of 2014 (<a href="https://github.com/mozilla/metrics-graphics">gh repo</a>) and was greeted with great fanfare. It's primary focus is on crisp, clean layouts for interactive time-series data, but they have support for other chart types as well (though said support is far from comprehensive).</p>

<p>I had been pondering building an R package to help generate these charts when Ramnath Vaidyanathan, Kenton Russell &amp; JJ Allaire came up with the insanely awesome <a href="http://www.htmlwidgets.org/">htmlwidgets</a> R package, which is the best javascript&lt;-&gt;R bridge to-date. Here's a quick take on how to make a basic line chart before going into some package (and MetricsGraphics) details:</p>

<div class="highlight highlight-R"><pre>library(<span class="pl-vo">metricsgraphics</span>)

<span class="pl-vo">tmp</span> <span class="pl-k">&lt;-</span> <span class="pl-st">data.frame</span>(<span class="pl-v">year</span><span class="pl-k">=</span>seq(<span class="pl-c1">1790</span>, <span class="pl-c1">1970</span>, <span class="pl-c1">10</span>), <span class="pl-v">uspop</span><span class="pl-k">=</span>as.numeric(<span class="pl-vo">uspop</span>))

<span class="pl-vo">tmp</span> %<span class="pl-k">&gt;</span>%
  mjs_plot(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-vo">year</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-vo">uspop</span>) %<span class="pl-k">&gt;</span>%
  mjs_line() %<span class="pl-k">&gt;</span>%
  mjs_add_marker(<span class="pl-c1">1850</span>, <span class="pl-s1"><span class="pl-pds">"</span>Something Wonderful<span class="pl-pds">"</span></span>) %<span class="pl-k">&gt;</span>%
  mjs_add_baseline(<span class="pl-c1">150</span>, <span class="pl-s1"><span class="pl-pds">"</span>Something Awful<span class="pl-pds">"</span></span>)</pre></div>

<center><b>Example of Basic MetricsGrahics Chart</b><iframe style="max-width=100%" src="1.html" sandbox="allow-same-origin allow-scripts" width="100%" height="350" scrolling="no" seamless="seamless" frameBorder="0"></iframe></center>

<p>One of the package goals (which should be evident from the example) is that it had to conform to the new "piping" idiom, made popular through the <a href="https://github.com/smbache/magrittr">magrittr</a>, <a href="http://ggvis.rstudio.com/">ggvis</a> and <a href="http://github.com/dplyr">dplyr</a> packages. This made it possible to avoid one function with a ton of parameters and help break out the chart building into logical steps. While it may not have the flexibility of <code>ggplot2</code>, you can do some neat things with MetricsGraphics charts, like use multiple lines:</p>

<div class="highlight highlight-R"><pre>set.seed(<span class="pl-c1">1492</span>)
<span class="pl-vo">stocks</span> <span class="pl-k">&lt;-</span> <span class="pl-st">data.frame</span>(
  <span class="pl-v">time</span> <span class="pl-k">=</span> as.Date(<span class="pl-s1"><span class="pl-pds">'</span>2009-01-01<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">9</span>,
  <span class="pl-v">X</span> <span class="pl-k">=</span> rnorm(<span class="pl-c1">10</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>),
  <span class="pl-v">Y</span> <span class="pl-k">=</span> rnorm(<span class="pl-c1">10</span>, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>),
  <span class="pl-v">Z</span> <span class="pl-k">=</span> rnorm(<span class="pl-c1">10</span>, <span class="pl-c1">0</span>, <span class="pl-c1">4</span>))

<span class="pl-vo">stocks</span> %<span class="pl-k">&gt;</span>%
  mjs_plot(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-vo">time</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-vo">X</span>, <span class="pl-v">width</span><span class="pl-k">=</span><span class="pl-c1">500</span>, <span class="pl-v">height</span><span class="pl-k">=</span><span class="pl-c1">350</span>) %<span class="pl-k">&gt;</span>%
  mjs_line() %<span class="pl-k">&gt;</span>%
  mjs_add_line(<span class="pl-vo">Y</span>) %<span class="pl-k">&gt;</span>%
  mjs_add_line(<span class="pl-vo">Z</span>) %<span class="pl-k">&gt;</span>%
  mjs_axis_x(<span class="pl-v">xax_format</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>) %<span class="pl-k">&gt;</span>%
  mjs_add_legend(c(<span class="pl-s1"><span class="pl-pds">"</span>X<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>Y<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>Z<span class="pl-pds">"</span></span>))</pre></div>

<center><b>Stocks X, Y &amp; Z over time</b><iframe style="max-width=100%" src="2.html" sandbox="allow-same-origin allow-scripts" width="100%" height="450" scrolling="no" seamless="seamless" frameBorder="0"></iframe></center>

<p>and, pretty configurable scatterplots:</p>

<div class="highlight highlight-R"><pre>library(<span class="pl-vo">RColorBrewer</span>)

<span class="pl-vo">mtcars</span> %<span class="pl-k">&gt;</span>%
  mjs_plot(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-vo">wt</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-vo">mpg</span>, <span class="pl-v">width</span><span class="pl-k">=</span><span class="pl-c1">500</span>, <span class="pl-v">height</span><span class="pl-k">=</span><span class="pl-c1">350</span>) %<span class="pl-k">&gt;</span>%
  mjs_point(<span class="pl-v">color_accessor</span><span class="pl-k">=</span><span class="pl-vo">cyl</span>,
            <span class="pl-v">x_rug</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">y_rug</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>,
            <span class="pl-v">size_accessor</span><span class="pl-k">=</span><span class="pl-vo">carb</span>,
            <span class="pl-v">size_range</span><span class="pl-k">=</span>c(<span class="pl-c1">5</span>, <span class="pl-c1">10</span>),
            <span class="pl-v">color_type</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>,
            <span class="pl-v">color_range</span><span class="pl-k">=</span>brewer.pal(<span class="pl-v">n</span><span class="pl-k">=</span><span class="pl-c1">11</span>, <span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>RdBu<span class="pl-pds">"</span></span>)[c(<span class="pl-c1">1</span>, <span class="pl-c1">5</span>, <span class="pl-c1">11</span>)]) %<span class="pl-k">&gt;</span>%
  mjs_labs(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>Weight of Car<span class="pl-pds">"</span></span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>Miles per Gallon<span class="pl-pds">"</span></span>)</pre></div>

<center><b>Motor Trend Cars - mpg~wt</b><iframe style="max-width=100%" src="3.html" sandbox="allow-same-origin allow-scripts" width="100%" height="350" scrolling="no" seamless="seamless" frameBorder="0"></iframe></center>

<p>The <code>htmlwidgets</code> developers go into <a href="http://www.htmlwidgets.org/develop_intro.html">great detail</a> on how to create a widget, but there are some central points I'll cover and potentially reiterate. </p>

<p>First, use the <code>htmlwidgets::scaffoldWidget</code> that <code>htmlwidgets</code> provides to kickstart your project. It'll setup the essentials and free your time up to work on the interface components. You will need to edit the generated <code>yaml</code> file to use the minified javascript files for things like jquery or d3 since Chrome will be unhappy if you don't.</p>

<p>Next, remember that all you're doing is building an R object with data to be passed into a javascript function/environment. MetricsGraphics made this a bit easier for me since the main graphic configuration is one, giant parameter list (take a look at the <code>metricsgraphics.js</code> source in github). </p>

<p>Third, if you need to customize the html generation function in the main <code>packagename_html</code> file, ensure you pass in <code>class</code> to the main <code>div</code> element. I was very pleased to discover that you can return a list of HTML elements vs  a single one:</p>

<div class="highlight highlight-r"><pre><span class="pl-en">metricsgraphics_html</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-vo">id</span>, <span class="pl-vo">style</span>, <span class="pl-vo">class</span>, <span class="pl-k">...</span>) {
  <span class="pl-st">list</span>(<span class="pl-vo">tags</span><span class="pl-k">$</span>div(<span class="pl-v">id</span> <span class="pl-k">=</span> <span class="pl-vo">id</span>, <span class="pl-v">class</span> <span class="pl-k">=</span> <span class="pl-vo">class</span>, <span class="pl-v">style</span><span class="pl-k">=</span><span class="pl-vo">style</span>),
       <span class="pl-vo">tags</span><span class="pl-k">$</span>div(<span class="pl-v">id</span> <span class="pl-k">=</span> sprintf(<span class="pl-s1"><span class="pl-pds">"</span>%s-legend<span class="pl-pds">"</span></span>, <span class="pl-vo">id</span>), <span class="pl-v">class</span> <span class="pl-k">=</span> sprintf(<span class="pl-s1"><span class="pl-pds">"</span>%s-legend<span class="pl-pds">"</span></span>, <span class="pl-vo">class</span>)))
}</pre></div>

<p>and that may eventually enable support for facet-like functionality without manually creating multiple plots.</p>

<p>Fourth, try to build around the piping idiom. It makes it so much easier to add parameters and manage the data environment. </p>

<p>Fifth, use <code>iframe</code>s for embedding your visualizations in other documents (like this blog post). It avoids potential namespace collisions and frees you from having to cut/paste HTML from one doc to another.</p>

<p>And, lastly, remember that you can generate your own <code>elementId</code> in the event you need to use it with your javascript visualization library (like I had to).</p>

<p>Currently, <code>metricsgraphics</code> is at 0.4.1 and has support for most of the basic chart types along with linking charts (in <code>Rmd</code> files). You can install it from the <a href="https://github.com/hrbrmstr/metricsgraphics">github repo</a> and make sure to file all issues or feature requests there. If you make something with it like <a href="https://github.com/abresler" class="user-mention">@abresler</a> <a href="http://asbcllc.com/blog/2015/January/ww2_tanks/">did</a>, drop a note in the comments!</p>

<p>Now, go forth and wrap some libraries!</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/hrbrmstr">hrbrmstr</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>